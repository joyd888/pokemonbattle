<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Pokémon Battle Comparison Tool</title>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #FFCC00 0%, #FF9900 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .filters {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .filter-group {
            margin-bottom: 15px;
        }

        .filter-group label {
            display: inline-block;
            width: 120px;
            font-weight: bold;
        }

        select, button {
            padding: 8px 12px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        .comparison-section {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .pokemon-card {
            flex: 1;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }

        .pokemon-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .pokemon-types {
            margin-bottom: 15px;
        }

        .type-badge {
            display: inline-block;
            padding: 5px 10px;
            margin: 2px;
            border-radius: 15px;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .pokemon-image {
            width: 96px;
            height: 96px;
            image-rendering: pixelated;
            margin: 10px auto;
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }

        .stat-item {
            text-align: left;
        }

        .stat-bar {
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin-top: 5px;
            overflow: hidden;
        }

        .stat-fill {
            height: 100%;
            transition: width 0.3s;
        }

        .battle-result {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-align: center;
        }

        .winner, .loser {
            font-weight: bold;
            font-size: 20px;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
        }

        .error {
            color: #f44336;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>&#9876; Pokémon Battle Comparison Tool</h1>
        <p>Compare any two Pokémon and see who would win in battle!</p>
    </div>

    <div class="filters">
        <div class="filter-group">
            <label>Type:</label>
            <select id="typeFilter">
                <option value="">All Types</option>
            </select>
        </div>

        <div class="filter-group">
            <label>Generation:</label>
            <select id="generationFilter">
                <option value="">All Generations</option>
            </select>
        </div>

        <div class="filter-group">
            <label>Legendary:</label>
            <select id="legendaryFilter">
                <option value="">All</option>
                <option value="true">Legendary Only</option>
                <option value="false">Non-Legendary Only</option>
            </select>
        </div>

        <button onclick="resetFilters()">Reset Filters</button>
    </div>

    <div class="comparison-section">
        <div class="pokemon-card">
            <div class="pokemon-name">Pokémon 1</div>
            <select id="pokemon1Selector">
                <option value="">Select Pokémon 1</option>
            </select>
            <div id="pokemon1Details"></div>
        </div>

        <div class="pokemon-card">
            <div class="pokemon-name">Pokémon 2</div>
            <select id="pokemon2Selector">
                <option value="">Select Pokémon 2</option>
            </select>
            <div id="pokemon2Details"></div>
        </div>
    </div>

    <div id="battleResult" class="battle-result">
        <div class="loading">Select two Pokémon to compare</div>
    </div>

    <div class="chart-container">
        <h3>Stats Comparison</h3>
        <div id="statsChart"></div>
    </div>

    <script src="pokemon_data.js"></script>
    <script>
        const typeColors = {
            normal: '#A8A878',
            fire: '#F08030',
            water: '#6890F0',
            electric: '#F8D030',
            grass: '#78C850',
            ice: '#98D8D8',
            fighting: '#C03028',
            poison: '#A040A0',
            ground: '#E0C068',
            flying: '#A890F0',
            psychic: '#F85888',
            bug: '#A8B820',
            rock: '#B8A038',
            ghost: '#705898',
            dragon: '#7038F8',
            dark: '#705848',
            steel: '#B8B8D0',
            fairy: '#EE99AC'
        };

        let filteredPokemon = [];
        let selectedPokemon1 = null;
        let selectedPokemon2 = null;

        function init() {
            if (typeof POKEMON_DATA === 'undefined') {
                document.getElementById('battleResult').innerHTML =
                    '<div class="error">Error: Pokémon data not loaded. Please check pokemon_data.js file.</div>';
                return;
            }

            filteredPokemon = POKEMON_DATA;
            populateFilters();
            populatePokemonSelectors();
        }

        function populateFilters() {
            const typeFilter = document.getElementById('typeFilter');
            const generationFilter = document.getElementById('generationFilter');

            const allTypes = new Set();
            POKEMON_DATA.forEach(pokemon => {
                pokemon.types.forEach(type => allTypes.add(type));
            });

            Array.from(allTypes).sort().forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type.charAt(0).toUpperCase() + type.slice(1);
                typeFilter.appendChild(option);
            });

            const generations = [...new Set(POKEMON_DATA.map(p => p.generation))].sort();
            generations.forEach(gen => {
                const option = document.createElement('option');
                option.value = gen;
                option.textContent = `Generation ${gen}`;
                generationFilter.appendChild(option);
            });

            typeFilter.addEventListener('change', updateFilters);
            generationFilter.addEventListener('change', updateFilters);
            document.getElementById('legendaryFilter').addEventListener('change', updateFilters);
        }

        function populatePokemonSelectors() {
            const selector1 = document.getElementById('pokemon1Selector');
            const selector2 = document.getElementById('pokemon2Selector');

            while (selector1.children.length > 1) selector1.removeChild(selector1.lastChild);
            while (selector2.children.length > 1) selector2.removeChild(selector2.lastChild);

            filteredPokemon.forEach(pokemon => {
                const option1 = document.createElement('option');
                option1.value = pokemon.id;
                option1.textContent = `#${pokemon.id} ${pokemon.name}`;
                selector1.appendChild(option1.cloneNode(true));

                const option2 = document.createElement('option');
                option2.value = pokemon.id;
                option2.textContent = `#${pokemon.id} ${pokemon.name}`;
                selector2.appendChild(option2);
            });

            selector1.addEventListener('change', (e) => selectPokemon(e.target.value, 1));
            selector2.addEventListener('change', (e) => selectPokemon(e.target.value, 2));
        }

        function updateFilters() {
            const typeFilter = document.getElementById('typeFilter').value;
            const generationFilter = document.getElementById('generationFilter').value;
            const legendaryFilter = document.getElementById('legendaryFilter').value;

            filteredPokemon = POKEMON_DATA.filter(pokemon => {
                const typeMatch = !typeFilter || pokemon.types.includes(typeFilter);
                const generationMatch = !generationFilter || pokemon.generation == generationFilter;
                const legendaryMatch =
                    !legendaryFilter ||
                    (legendaryFilter === 'true' && pokemon.legendary) ||
                    (legendaryFilter === 'false' && !pokemon.legendary);

                return typeMatch && generationMatch && legendaryMatch;
            });

            populatePokemonSelectors();

            if (selectedPokemon1 && !filteredPokemon.find(p => p.id === selectedPokemon1.id)) {
                selectedPokemon1 = null;
                document.getElementById('pokemon1Selector').value = '';
                document.getElementById('pokemon1Details').innerHTML = '';
            }

            if (selectedPokemon2 && !filteredPokemon.find(p => p.id === selectedPokemon2.id)) {
                selectedPokemon2 = null;
                document.getElementById('pokemon2Selector').value = '';
                document.getElementById('pokemon2Details').innerHTML = '';
            }

            updateBattleAnalysis();
        }

        function resetFilters() {
            document.getElementById('typeFilter').value = '';
            document.getElementById('generationFilter').value = '';
            document.getElementById('legendaryFilter').value = '';
            updateFilters();
        }

        function selectPokemon(pokemonId, slot) {
            const pokemon = POKEMON_DATA.find(p => p.id == pokemonId);

            if (slot === 1) {
                selectedPokemon1 = pokemon;
                updatePokemonDetails(pokemon, 'pokemon1Details');
            } else {
                selectedPokemon2 = pokemon;
                updatePokemonDetails(pokemon, 'pokemon2Details');
            }

            updateBattleAnalysis();
        }

        function getPokemonColors(pokemon) {
            const primaryType = pokemon.types[0];
            const secondaryType = pokemon.types[1];
            const primaryColor = typeColors[primaryType] || '#4CAF50';
            const secondaryColor = secondaryType ? (typeColors[secondaryType] || primaryColor) : primaryColor;
            return { primaryColor, secondaryColor };
        }

        function updatePokemonDetails(pokemon, elementId) {
            if (!pokemon) {
                document.getElementById(elementId).innerHTML = '';
                return;
            }

            const detailsDiv = document.getElementById(elementId);

            const typeBadges = pokemon.types.map(type =>
                `<span class="type-badge" style="background-color: ${typeColors[type] || '#777'}">${type}</span>`
            ).join('');

            const stats = pokemon.stats;
            const totalStats = Object.values(stats).reduce((sum, val) => sum + val, 0);

            const { primaryColor, secondaryColor } = getPokemonColors(pokemon);
            const barBackground = primaryColor === secondaryColor
                ? primaryColor
                : `linear-gradient(90deg, ${primaryColor}, ${secondaryColor})`;

            const spriteUrl =
                "https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/" +
                pokemon.id +
                ".png";

            const statsHTML = `
                <img class="pokemon-image"
                     src="${spriteUrl}"
                     alt="${pokemon.name}">
                <div class="pokemon-types">${typeBadges}</div>
                <div><strong>Total Stats:</strong> ${totalStats}</div>
                <div class="stats-grid">
                    ${Object.entries(stats).map(([stat, value]) => `
                        <div class="stat-item">
                            <div>${stat.toUpperCase()}: ${value}</div>
                            <div class="stat-bar">
                                <div class="stat-fill"
                                     style="
                                        width: ${(value / 255) * 100}%;
                                        background: ${barBackground};
                                     ">
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;

            detailsDiv.innerHTML = statsHTML;
        }

        function updateBattleAnalysis() {
            const battleResult = document.getElementById('battleResult');

            if (!selectedPokemon1 || !selectedPokemon2) {
                battleResult.innerHTML = '<div class="loading">Select two Pokémon to compare</div>';
                document.getElementById('statsChart').innerHTML = '';
                return;
            }

            const score1 = calculateBattleScore(selectedPokemon1, selectedPokemon2);
            const score2 = calculateBattleScore(selectedPokemon2, selectedPokemon1);

            const colors1 = getPokemonColors(selectedPokemon1);
            const colors2 = getPokemonColors(selectedPokemon2);

            let winnerText = '';
            if (score1 > score2) {
                winnerText = `
                    <span class="winner" style="color:${colors1.primaryColor};">
                        ${selectedPokemon1.name}
                    </span>
                    wins against
                    <span class="loser" style="color:${colors2.primaryColor};">
                        ${selectedPokemon2.name}
                    </span>
                `;
            } else if (score2 > score1) {
                winnerText = `
                    <span class="winner" style="color:${colors2.primaryColor};">
                        ${selectedPokemon2.name}
                    </span>
                    wins against
                    <span class="loser" style="color:${colors1.primaryColor};">
                        ${selectedPokemon1.name}
                    </span>
                `;
            } else {
                winnerText = `
                    <span class="winner" style="color:${colors1.primaryColor};">
                        ${selectedPokemon1.name}
                    </span>
                    and
                    <span class="winner" style="color:${colors2.primaryColor};">
                        ${selectedPokemon2.name}
                    </span>
                    tie
                `;
            }

            battleResult.innerHTML = `
                <h2>Battle Result</h2>
                <div style="font-size: 18px; margin: 10px 0;">
                    ${winnerText}
                </div>
                <div style="margin-top: 15px;">
                    <strong>${selectedPokemon1.name}:</strong> ${score1.toFixed(1)} points<br>
                    <strong>${selectedPokemon2.name}:</strong> ${score2.toFixed(1)} points
                </div>
            `;

            createStatsChart();
        }

        function calculateBattleScore(attacker, defender) {
            const stats = attacker.stats;

            const score =
                stats.attack * 1.2 +
                stats.special_attack * 1.1 +
                stats.speed * 1.3 +
                stats.defense * 0.8 +
                stats.special_defense * 0.8 +
                stats.hp * 0.7;

            return score;
        }

        function createStatsChart() {
            const container = document.getElementById('statsChart');
            container.innerHTML = '';

            const legendWidth = 160;
            const margin = { top: 20, right: 20, bottom: 70, left: 40 };
            const baseWidth = 600;
            const width = baseWidth - margin.left - margin.right - legendWidth;
            const height = 300 - margin.top - margin.bottom;

            const svg = d3.select('#statsChart')
                .append('svg')
                .attr('width', width + margin.left + margin.right + legendWidth)
                .attr('height', height + margin.top + margin.bottom)
                .append('g')
                .attr('transform', `translate(${margin.left},${margin.top})`);

            const stats = Object.keys(selectedPokemon1.stats);

            const statLabelMap = {
                hp: 'HP',
                attack: 'ATK',
                defense: 'DEF',
                special_attack: 'SPA',
                special_defense: 'SPD',
                speed: 'SPE'
            };

            const data = stats.map(stat => ({
                stat: stat,
                pokemon1: selectedPokemon1.stats[stat],
                pokemon2: selectedPokemon2.stats[stat]
            }));

            const x = d3.scale.ordinal()
                .domain(stats)
                .rangeRoundBands([0, width], 0.1);

            const y = d3.scale.linear()
                .domain([0, d3.max(data, d => Math.max(d.pokemon1, d.pokemon2))])
                .range([height, 0]);

            const xAxis = d3.svg.axis()
                .scale(x)
                .orient('bottom')
                .tickFormat(d => statLabelMap[d] || d);

            const yAxis = d3.svg.axis()
                .scale(y)
                .orient('left');

            svg.append('g')
                .attr('class', 'x axis')
                .attr('transform', `translate(0,${height})`)
                .call(xAxis)
                .selectAll('text')
                .style('text-anchor', 'end')
                .attr('dx', '-0.5em')
                .attr('dy', '0.15em')
                .attr('transform', 'rotate(-35)');

            svg.append('g')
                .attr('class', 'y axis')
                .call(yAxis);

            const defs = svg.append('defs');

            function createGradient(id, pokemon) {
                const colors = getPokemonColors(pokemon);
                const grad = defs.append('linearGradient')
                    .attr('id', id)
                    .attr('x1', '0%')
                    .attr('y1', '0%')
                    .attr('x2', '100%')
                    .attr('y2', '0%');

                grad.append('stop')
                    .attr('offset', '0%')
                    .attr('stop-color', colors.primaryColor);

                grad.append('stop')
                    .attr('offset', '100%')
                    .attr('stop-color', colors.secondaryColor);
            }

            createGradient('gradPokemon1', selectedPokemon1);
            createGradient('gradPokemon2', selectedPokemon2);

            svg.selectAll('.bar1')
                .data(data)
                .enter()
                .append('rect')
                .attr('class', 'bar1')
                .attr('x', d => x(d.stat))
                .attr('y', d => y(d.pokemon1))
                .attr('width', x.rangeBand() / 2)
                .attr('height', d => height - y(d.pokemon1))
                .style('fill', 'url(#gradPokemon1)');

            svg.selectAll('.bar2')
                .data(data)
                .enter()
                .append('rect')
                .attr('class', 'bar2')
                .attr('x', d => x(d.stat) + x.rangeBand() / 2)
                .attr('y', d => y(d.pokemon2))
                .attr('width', x.rangeBand() / 2)
                .attr('height', d => height - y(d.pokemon2))
                .style('fill', 'url(#gradPokemon2)');

            const legend = svg.append('g')
                .attr('transform', `translate(${width + 20}, 10)`);

            legend.append('rect')
                .attr('width', 16)
                .attr('height', 16)
                .style('fill', 'url(#gradPokemon1)');

            legend.append('text')
                .attr('x', 22)
                .attr('y', 12)
                .style('font-size', '12px')
                .text(selectedPokemon1.name);

            legend.append('rect')
                .attr('y', 24)
                .attr('width', 16)
                .attr('height', 16)
                .style('fill', 'url(#gradPokemon2)');

            legend.append('text')
                .attr('x', 22)
                .attr('y', 36)
                .style('font-size', '12px')
                .text(selectedPokemon2.name);

            legend.append('text')
                .attr('x', 0)
                .attr('y', 64)
                .style('font-size', '11px')
                .style('font-weight', 'bold')
                .text('Stat abbreviations:');

            const abbrevLines = [
                'HP  = Hit Points',
                'ATK = Attack',
                'DEF = Defense',
                'SPA = Special Attack',
                'SPD = Special Defense',
                'SPE = Speed'
            ];

            abbrevLines.forEach((line, i) => {
                legend.append('text')
                    .attr('x', 0)
                    .attr('y', 80 + i * 12)
                    .style('font-size', '10px')
                    .text(line);
            });
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
